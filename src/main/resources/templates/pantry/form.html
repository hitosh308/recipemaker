<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<div th:fragment="form(actionUrl)">
    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
    <div th:if="${estimateWarning}" class="alert alert-warning" th:text="${estimateWarning}"></div>

    <form class="card shadow-sm" method="post" th:action="${actionUrl}" th:object="${form}">
        <div class="card-body">
            <div class="mb-3">
                <label class="form-label" for="name">食材名 <span class="text-danger">*</span></label>
                <input class="form-control" id="name" th:field="*{name}"
                       th:classappend="${#fields.hasErrors('name')} ? 'is-invalid'">
                <div class="invalid-feedback" th:errors="*{name}"></div>
            </div>

            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label" for="quantity">数量 <span class="text-danger">*</span></label>
                    <input class="form-control" id="quantity" min="0" step="0.01" type="number"
                           th:field="*{quantity}" th:classappend="${#fields.hasErrors('quantity')} ? 'is-invalid'">
                    <div class="invalid-feedback" th:errors="*{quantity}"></div>
                </div>
                <div class="col-md-6">
                    <label class="form-label" for="unit">単位 <span class="text-danger">*</span></label>
                    <input class="form-control" id="unit" placeholder="例: g, 個, ml"
                           th:field="*{unit}" th:classappend="${#fields.hasErrors('unit')} ? 'is-invalid'">
                    <div class="invalid-feedback" th:errors="*{unit}"></div>
                </div>
            </div>

            <div class="row g-3 mt-1">
                <div class="col-md-6">
                    <label class="form-label" for="storageType">保存方法 <span class="text-danger">*</span></label>
                    <select class="form-select" id="storageType" th:field="*{storageType}"
                            th:classappend="${#fields.hasErrors('storageType')} ? 'is-invalid'">
                        <option value="" disabled>選択してください</option>
                        <option th:each="type : ${storageTypes}" th:text="${type}" th:value="${type}"></option>
                    </select>
                    <div class="invalid-feedback" th:errors="*{storageType}"></div>
                </div>
                <div class="col-md-6">
                    <label class="form-label" for="purchasedAt">購入日 <span class="text-danger">*</span></label>
                    <input class="form-control" id="purchasedAt" type="date"
                           th:field="*{purchasedAt}"
                           th:classappend="${#fields.hasErrors('purchasedAt')} ? 'is-invalid'">
                    <div class="invalid-feedback" th:errors="*{purchasedAt}"></div>
                </div>
            </div>

            <div class="mt-3">
                <label class="form-label" for="expiresAtOverride">期限上書き</label>
                <input class="form-control" id="expiresAtOverride" type="date" th:field="*{expiresAtOverride}">
                <div class="form-text">必要に応じて推定期限を上書きできます。</div>
            </div>
        </div>

        <div class="card-footer d-flex gap-2">
            <button class="btn btn-primary" type="submit">保存</button>
            <a class="btn btn-outline-secondary" th:href="@{/pantry}">キャンセル</a>
        </div>
    </form>

    <div class="card mt-4" th:if="${item != null}">
        <div class="card-body">
            <h2 class="h6 mb-3">推定結果</h2>
            <dl class="row mb-0">
                <dt class="col-sm-5">推定消費期限（日数）</dt>
                <dd class="col-sm-7" th:text="${item.shelfLifeDaysPredicted} ?: '-'"></dd>
                <dt class="col-sm-5">推定期限日</dt>
                <dd class="col-sm-7" th:text="${item.expiresAtPredicted} ?: '-'"></dd>
                <dt class="col-sm-5">推定信頼度</dt>
                <dd class="col-sm-7" th:text="${item.expireConfidence} ?: '-'"></dd>
            </dl>
        </div>
    </div>
</div>
</html>
